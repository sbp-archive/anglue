{"version":3,"sources":["../../src/application.js"],"names":[],"mappings":"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","file":"application.js","sourcesContent":["import angular from 'angular';\n\nimport {Annotation} from './annotation';\nimport {Annotations} from './annotations';\n\nimport {\n  mergeStaticGetterObject,\n  mergeStaticGetterArray,\n  addStaticGetter\n} from './utils';\n\nexport class ApplicationAnnotation extends Annotation {\n  get dependencies() {\n    const targetCls = this.targetCls;\n    const extraDependencies = ['luxyflux'];\n    if (targetCls.routes) {\n      extraDependencies.push('ui.router');\n    }\n    return extraDependencies.concat(\n      targetCls.dependencies || [],\n      Annotation.getModuleNames(targetCls.components),\n      Annotation.getModuleNames(targetCls.stores),\n      Annotation.getModuleNames(targetCls.actions)\n    );\n  }\n\n  get module() {\n    if (!this._module) {\n      const annotationNames = Annotation.getAnnotationServiceNames(this.targetCls.stores);\n      const controllerDependencies = annotationNames.concat([() => {}]);\n\n      this._module = angular.module(\n        this.name,\n        this.dependencies\n      ).run(controllerDependencies);\n\n      this.configure(this._module);\n    }\n\n    return this._module;\n  }\n\n  configure(angularModule) {\n    const routes = this.targetCls.routes;\n\n    // The ApplicationDispatcher is the (singleton) dispatcher instance used\n    // in our entire application. Every ActionCreator in this app dispatches\n    // through this instance and all app stores are registered to it\n    angularModule.service('ApplicationDispatcher', [\n      'LuxyFluxDispatcher',\n      function(Dispatcher) {\n        return new Dispatcher('ApplicationDispatcher');\n      }\n    ]);\n\n    if (routes) {\n      angularModule.config([\n        '$stateProvider',\n        '$urlRouterProvider',\n        function routerConfig($stateProvider, $urlRouterProvider) {\n          if (routes.defaultRoute) {\n            $urlRouterProvider.otherwise(routes.defaultRoute);\n            Reflect.deleteProperty(routes, 'defaultRoute');\n          }\n\n          Object.keys(routes).forEach(name => {\n            $stateProvider.state(name, routes[name]);\n          });\n        }\n      ]);\n    }\n  }\n}\n\nexport default ApplicationAnnotation;\n\nexport function Application(config) {\n  return cls => {\n    let applicationName;\n    const isConfigObject = angular.isObject(config);\n\n    if (isConfigObject && config.name) {\n      applicationName = config.name;\n    } else if (angular.isString(config)) {\n      applicationName = config;\n    } else {\n      const clsName = cls.name.replace(/application$/i, '');\n      applicationName = `${clsName[0].toLowerCase()}${clsName.slice(1)}`;\n    }\n\n    if (isConfigObject) {\n      if (config.routes) {\n        mergeStaticGetterObject(cls, 'routes', config.routes);\n      }\n      if (config.dependencies) {\n        mergeStaticGetterArray(cls, 'dependencies', config.dependencies);\n      }\n      if (config.components) {\n        mergeStaticGetterArray(cls, 'components', config.components);\n      }\n      if (config.stores) {\n        mergeStaticGetterArray(cls, 'stores', config.stores);\n      }\n      if (config.actions) {\n        mergeStaticGetterArray(cls, 'actions', config.actions);\n      }\n    }\n\n    addStaticGetter(cls, 'annotation', () => Annotations.getApplication(applicationName, cls));\n  };\n}\n"]}