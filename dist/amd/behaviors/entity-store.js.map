{"version":3,"sources":["../../../src/behaviors/entity-store.js"],"names":[],"mappings":"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","file":"entity-store.js","sourcesContent":["import angular from 'angular';\nimport {Behavior} from './behavior';\nimport {Handler as handlerDecorator} from '../store';\nimport {Transformable as transformableDecorator} from './transformable';\nimport {\n  addBehavior,\n  camelcase,\n  Inject as injectDecorator\n} from '../utils';\n\nexport class EntityStoreBehavior extends Behavior {\n  isLoading = false;\n  isCreating = false;\n  isReading = false;\n  isUpdating = false;\n  isDeleting = false;\n  isSet = false;\n  hasDetailSet = new Set();\n\n  constructor(instance, {idProperty, collection} = {}) {\n    super(...arguments);\n\n    this.idProperty = idProperty || 'id';\n    this.collection = collection || 'items';\n    this.reset();\n  }\n\n  reset() {\n    this.loadDeferred = this.createNewDeferred();\n    this.createDeferred = this.createNewDeferred();\n    this.readDeferred = this.createNewDeferred();\n    this.updateDeferred = this.createNewDeferred();\n    this.deleteDeferred = this.createNewDeferred();\n\n    this.isSet = false;\n    this.items = [];\n    this.hasDetailSet.clear();\n  }\n\n  get items() {\n    return this.instance.transformables[this.collection].data;\n  }\n\n  set items(items) {\n    this.instance.transformables[this.collection].data = items;\n  }\n\n  get isEmpty() {\n    return this.isSet && !this.items.length;\n  }\n\n  get isBusy() {\n    return Boolean(this.isLoading ||\n                   this.isCreating ||\n                   this.isReading ||\n                   this.isUpdating ||\n                   this.isDeleting);\n  }\n\n  get loadPromise() {\n    return this.loadDeferred.promise;\n  }\n\n  get createPromise() {\n    return this.createDeferred.promise;\n  }\n\n  get readPromise() {\n    return this.readDeferred.promise;\n  }\n\n  get updatePromise() {\n    return this.updateDeferred.promise;\n  }\n\n  get deletePromise() {\n    return this.deleteDeferred.promise;\n  }\n\n  createNewDeferred() {\n    return this.instance.$q.defer();\n  }\n\n  onChanged() {\n    this.instance.transformables[this.collection].refresh();\n    this.instance.emit('changed', ...arguments);\n  }\n\n  onError() {\n    this.instance.emit('error', ...arguments);\n  }\n\n  getById(entityId) {\n    return this.items.find(entity => entity[this.idProperty] === entityId) || null;\n  }\n\n  getByPropertyValue(property, value) {\n    return this.items.find(entity => entity[property] === value) || null;\n  }\n\n  hasDetails(entityId) {\n    return this.hasDetailSet.has(entityId);\n  }\n\n  onLoadStarted() {\n    this.isLoading = true;\n    this.loadDeferred = this.createNewDeferred();\n  }\n\n  onLoadCompleted(entities) {\n    const items = this.items;\n\n    this.isSet = true;\n    this.isLoading = false;\n    this.hasDetailSet.clear();\n\n    if (entities && entities.length) {\n      items.splice(0, items.length);\n      items.splice(0, 0, ...entities);\n    }\n\n    this.onChanged('load', entities);\n\n    this.loadDeferred.resolve(entities);\n  }\n\n  onLoadFailed(error) {\n    this.isLoading = false;\n\n    this.onError('load', error);\n\n    this.loadDeferred.reject(error);\n  }\n\n  onCreateStarted() {\n    this.isCreating = true;\n    this.createDeferred = this.createNewDeferred();\n  }\n\n  onCreateCompleted(entity) {\n    const entityId = entity[this.idProperty];\n    let currentEntity = this.getById(entityId);\n\n    if (currentEntity) {\n      Object.assign(currentEntity, entity);\n    } else {\n      this.items.push(entity);\n      currentEntity = entity;\n    }\n\n    this.isSet = true;\n    this.isCreating = false;\n    this.hasDetailSet.add(entityId);\n\n    this.onChanged('create', currentEntity);\n\n    this.createDeferred.resolve(currentEntity);\n  }\n\n  onCreateFailed(error) {\n    this.isCreating = false;\n\n    this.onError('create', error);\n\n    this.createDeferred.reject(error);\n  }\n\n  onReadStarted() {\n    this.isReading = true;\n    this.readDeferred = this.createNewDeferred();\n  }\n\n  onReadCompleted(entity) {\n    const entityId = entity[this.idProperty];\n    let currentEntity = this.getById(entityId);\n\n    if (currentEntity) {\n      Object.assign(currentEntity, entity);\n    } else {\n      this.items.push(entity);\n      currentEntity = entity;\n    }\n\n    this.isSet = true;\n    this.isReading = false;\n    this.hasDetailSet.add(entityId);\n\n    this.onChanged('read', currentEntity);\n\n    this.readDeferred.resolve(entity);\n  }\n\n  onReadFailed(error) {\n    this.isReading = false;\n\n    this.onError('read', error);\n\n    this.readDeferred.reject(error);\n  }\n\n  onUpdateStarted() {\n    this.isUpdating = true;\n    this.updateDeferred = this.createNewDeferred();\n  }\n\n  onUpdateCompleted(entity) {\n    const entityId = entity[this.idProperty];\n    const currentEntity = this.getById(entityId);\n\n    this.isUpdating = false;\n\n    if (!currentEntity) {\n      this.updateDeferred.reject('Updated entity that is not in this store...', entity);\n      return;\n    }\n\n    Object.assign(currentEntity, entity);\n    this.hasDetailSet.add(entityId);\n\n    this.onChanged('update', currentEntity);\n\n    this.updateDeferred.resolve(entity);\n  }\n\n  onUpdateFailed(error) {\n    this.isUpdating = false;\n\n    this.onError('update', error);\n\n    this.updateDeferred.reject(error);\n  }\n\n  onDeleteStarted() {\n    this.isDeleting = true;\n    this.deleteDeferred = this.createNewDeferred();\n  }\n\n  onDeleteCompleted(entity) {\n    const entityId = entity[this.idProperty];\n    const currentEntity = this.getById(entityId);\n\n    this.isDeleting = false;\n\n    if (!currentEntity) {\n      this.deleteDeferred.reject('Deleting entity that is not in this store...', entity);\n      return;\n    }\n\n    this.items.splice(this.items.indexOf(currentEntity), 1);\n    this.hasDetailSet.add(entityId);\n\n    this.onChanged('delete', currentEntity);\n\n    this.deleteDeferred.resolve(entity);\n  }\n\n  onDeleteFailed(error) {\n    this.isDeleting = false;\n\n    this.onError('delete', error);\n\n    this.deleteDeferred.reject(error);\n  }\n}\n\nexport function EntityStore(config = {}) {\n  return cls => {\n    let preparedConfig = config;\n    if (angular.isString(config)) {\n      preparedConfig = {entity: config};\n    }\n\n    preparedConfig = Object.assign({\n      actions: ['load', 'create', 'read', 'update', 'delete'],\n      collection: 'items',\n      entity: cls.name.replace(/store$/i, ''),\n      idProperty: 'id'\n    }, preparedConfig);\n    preparedConfig.entity = camelcase(preparedConfig.entity);\n\n    injectDecorator()(cls.prototype, '$q');\n    transformableDecorator()(cls.prototype, preparedConfig.collection);\n\n    const actionHandlers = [];\n    for (const action of preparedConfig.actions) {\n      const actionName = camelcase(action);\n      const entityAction = `on${preparedConfig.entity}${actionName}`;\n      const startedAction = `${entityAction}Started`;\n      const completedAction = `${entityAction}Completed`;\n      const failedAction = `${entityAction}Failed`;\n\n      actionHandlers.push(`${startedAction}:on${actionName}Started`);\n      actionHandlers.push(`${completedAction}:on${actionName}Completed`);\n      actionHandlers.push(`${failedAction}:on${actionName}Failed`);\n\n      const handlerDecorate = handlerDecorator(null, false);\n      handlerDecorate(cls.prototype, startedAction);\n      handlerDecorate(cls.prototype, completedAction);\n      handlerDecorate(cls.prototype, failedAction);\n    }\n\n    addBehavior(cls, EntityStoreBehavior, {\n      property: 'entityStore',\n      config: preparedConfig,\n      proxy: [\n        'isSet',\n        'isEmpty',\n        'isBusy',\n\n        'loadPromise',\n        'createPromise',\n        'readPromise',\n        'updatePromise',\n        'deletePromise',\n\n        'isLoading',\n        'isCreating',\n        'isReading',\n        'isUpdating',\n        'isDeleting',\n\n        'reset',\n        'hasDetails',\n        'getById'\n      ].concat(actionHandlers)\n    });\n  };\n}\n"]}