{"version":3,"sources":["../../src/component.js"],"names":[],"mappings":"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","file":"component.js","sourcesContent":["import angular from 'angular';\n\nimport {Annotation} from './annotation';\nimport {Annotations} from './annotations';\n\nimport {addStaticGetterObjectMember, addStaticGetter} from './utils';\n\nexport class ComponentEvent {\n  expression = null;\n  fire(locals) {\n    this.expression(locals);\n  }\n}\n\nexport class ComponentAnnotation extends Annotation {\n  get controllerCls() {\n    const annotation = this;\n    const TargetCls = this.targetCls;\n    const flags = this.flags;\n\n    class ControllerCls extends TargetCls {\n      constructor($scope, $log) {\n        const injected = Array.from(arguments).slice(2);\n\n        super(...injected);\n\n        annotation.applyInjectionBindings(this, injected);\n        annotation.applyDecorators(this);\n\n        if (flags) {\n          Object.keys(flags).forEach(flag => {\n            const flagBinding = `_${flag}Flag`;\n            Reflect.defineProperty(this, flag, {\n              get: () => angular.isDefined(this[flagBinding]) ? this[flagBinding] !== 'false' : false\n            });\n          });\n        }\n\n        if (this.onDestroy instanceof Function) {\n          $scope.$on('$destroy', this.onDestroy.bind(this));\n        }\n\n        if (this.activate instanceof Function) {\n          this.activate();\n        }\n\n        this.fireComponentEvent = (event, locals) => {\n          $log.warn(`\n            Component.fireComponentEvent() has been deprecated in Anglue 1.x.\n            Please use @Event() myEvent; in combination with this.myEvent.fire().\n          `);\n          if (this._eventHandlers && this._eventHandlers[event]) {\n            Reflect.apply(this._eventHandlers[event], this, [locals]);\n          }\n        };\n      }\n    }\n\n    return ControllerCls;\n  }\n\n  getInjectionTokens() {\n    return ['$scope', '$log'].concat(super.getInjectionTokens());\n  }\n\n  get dependencies() {\n    const targetCls = this.targetCls;\n    return [].concat(\n      targetCls.dependencies || [],\n      Annotation.getModuleNames(targetCls.components)\n    );\n  }\n\n  get template() {\n    return this.targetCls.template || null;\n  }\n\n  get bindings() {\n    return this.targetCls.bindings || null;\n  }\n\n  get events() {\n    return this.targetCls.events || null;\n  }\n\n  get flags() {\n    return this.targetCls.flags || null;\n  }\n\n  //noinspection InfiniteRecursionJS\n  get getDirective() {\n    return this.targetCls.getDirective || function(config) {\n      return function() {\n        return config;\n      };\n    };\n  }\n\n  get module() {\n    if (!this._module) {\n      const name = this.name;\n      const template = this.template;\n      const bindings = this.bindings;\n      const events = this.events;\n\n      this._module = angular.module(\n        `components.${name}`,\n        this.dependencies\n      );\n\n      const directiveConfig = {\n        restrict: 'EA',\n        controllerAs: name,\n        bindToController: true,\n        scope: true,\n        controller: this.getInjectionTokens().concat([this.controllerCls])\n      };\n\n      if (template) {\n        if (template.url) {\n          directiveConfig.templateUrl = template.url;\n        } else if (template.inline) {\n          directiveConfig.template = template.inline;\n        }\n        if (template.replace) {\n          directiveConfig.replace = true;\n        }\n      }\n\n      if (bindings) {\n        const scope = directiveConfig.scope = {};\n        for (const binding of Object.keys(bindings)) {\n          let attr = bindings[binding];\n          if (!attr[0].match(/(&|=|@)/)) {\n            attr = `=${attr}`;\n          }\n          scope[binding] = attr;\n        }\n      }\n\n      if (events) {\n        directiveConfig.link = (scope, el, attr, ctrl) => {\n          if (events) {\n            const eventHandlers = ctrl._eventHandlers = {};\n            Object.keys(events).forEach(event => {\n              if (attr[event]) {\n                eventHandlers[events[event]] = locals => {\n                  scope.$parent.$eval(attr[event], locals);\n                };\n                const componentEventName = events[event];\n                if (ctrl[componentEventName] instanceof ComponentEvent) {\n                  ctrl[componentEventName].expression = ctrl[`_${componentEventName}Expression`];\n                }\n              }\n            });\n          }\n        };\n      }\n\n      this._module.directive(name, this.getDirective(directiveConfig));\n\n      this.configure(this._module);\n    }\n\n    return this._module;\n  }\n}\n\nexport default ComponentAnnotation;\n\nexport function Component(config) {\n  return cls => {\n    let componentName;\n    const isConfigObject = angular.isObject(config);\n\n    if (isConfigObject && config.name) {\n      componentName = config.name;\n    } else if (angular.isString(config)) {\n      componentName = config;\n    } else {\n      const clsName = cls.name.replace(/component$/i, '');\n      componentName = `${clsName[0].toLowerCase()}${clsName.slice(1)}`;\n    }\n\n    if (isConfigObject && config.dependencies) {\n      addStaticGetter(cls, 'dependencies', () => config.dependencies);\n    }\n    addStaticGetter(cls, 'annotation', () => Annotations.getComponent(componentName, cls));\n  };\n}\n\nexport function View(config) {\n  return cls => {\n    if (config.template) {\n      addStaticGetter(cls, 'template', () => ({\n        inline: config.template,\n        replace: config.replace || false\n      }));\n    } else if (config.templateUrl) {\n      addStaticGetter(cls, 'template', () => ({\n        url: config.templateUrl,\n        replace: config.replace || false\n      }));\n    }\n    if (config.components) {\n      addStaticGetter(cls, 'components', () => config.components);\n    }\n  };\n}\n\nexport function Binding(config) {\n  return (cls, propertyName, descriptor) => {\n    const isConfigObject = angular.isObject(config);\n    let attribute = propertyName;\n\n    if (isConfigObject && config.attribute) {\n      attribute = config.attribute;\n    } else if (angular.isString(config)) {\n      attribute = config;\n    }\n\n    if (isConfigObject && config.expression === true) {\n      attribute = `&${attribute}`;\n    } else if (isConfigObject && config.string === true) {\n      attribute = `@${attribute}`;\n    } else {\n      attribute = `=${attribute}`;\n    }\n\n    // For some reason these property initializers are called after\n    // the bindings have already been set by angular. This causes\n    // them to be set back to undefined again. Thus this override\n    // to make sure we just return whatever the value was already.\n    if (descriptor.initializer !== undefined) {\n      descriptor.initializer = function() {\n        return this[propertyName];\n      };\n    }\n\n    addStaticGetterObjectMember(cls.constructor, 'bindings', propertyName, attribute);\n  };\n}\n\nexport function Flag(config) {\n  return (cls, propertyName) => {\n    const attribute = config || propertyName;\n    addStaticGetterObjectMember(cls.constructor, 'flags', propertyName, attribute);\n\n    const propertyBinding = `_${propertyName}Flag`;\n    const attributeBinding = `@${attribute}`;\n    addStaticGetterObjectMember(cls.constructor, 'bindings', propertyBinding, attributeBinding);\n  };\n}\n\nexport function Event() {\n  return (cls, propertyName, descriptor) => {\n    const attribute = `on${propertyName[0].toUpperCase()}${propertyName.slice(1)}`;\n    if (!descriptor.initializer) {\n      descriptor.initializer = () => {\n        return new ComponentEvent();\n      };\n    }\n    addStaticGetterObjectMember(cls.constructor, 'events', attribute, propertyName);\n    addStaticGetterObjectMember(cls.constructor, 'bindings',\n      `_${propertyName}Expression`, `&${attribute}`);\n  };\n}\n"]}