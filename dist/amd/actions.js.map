{"version":3,"sources":["../../src/actions.js"],"names":[],"mappings":"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","file":"actions.js","sourcesContent":["import angular from 'angular';\n\nimport {Annotation} from './annotation';\nimport {Annotations} from './annotations';\n\nimport {addStaticGetterObjectMember, addStaticGetter} from './utils';\n\n\nexport class ActionsAnnotation extends Annotation {\n  get serviceName() {\n    const name = this.name;\n    return `${name[0].toUpperCase()}${name.slice(1)}Actions`;\n  }\n\n  getInjectionTokens() {\n    return [\n      'LuxyFlux',\n      'LuxyFluxActionCreators',\n      'ApplicationDispatcher'\n    ].concat(super.getInjectionTokens());\n  }\n\n  get factoryFn() {\n    const TargetCls = this.targetCls;\n    const annotation = this;\n\n    return function(LuxyFlux, LuxyFluxActionCreators, ApplicationDispatcher) {\n      const injected = Array.from(arguments).slice(3);\n      const instance = new TargetCls(...injected);\n\n      annotation.applyInjectionBindings(instance, injected);\n      annotation.applyBehaviors(instance);\n      annotation.applyDecorators(instance);\n\n      return LuxyFlux.createActions({\n        dispatcher: ApplicationDispatcher,\n        serviceActions: TargetCls.serviceActions,\n        decorate: instance\n      }, LuxyFluxActionCreators);\n    };\n  }\n\n  get module() {\n    if (!this._module) {\n      this._module = angular.module(\n        `actions.${this.name}`,\n        this.dependencies\n      );\n\n      this._module.factory(\n        this.serviceName,\n        this.getInjectionTokens().concat([this.factoryFn])\n      );\n\n      this.configure(this._module);\n    }\n    return this._module;\n  }\n}\n\n// Decorators\nexport function Actions(config) {\n  return cls => {\n    let actionsName;\n    const isConfigObject = angular.isObject(config);\n\n    if (isConfigObject && config.name) {\n      actionsName = config.name;\n    } else if (angular.isString(config)) {\n      actionsName = config;\n    } else {\n      const clsName = cls.name.replace(/actions$/i, '');\n      actionsName = `${clsName[0].toLowerCase()}${clsName.slice(1)}`;\n    }\n\n    const namespace = isConfigObject && config.namespace !== undefined\n      ? config.namespace\n      : actionsName;\n\n    cls.actionNamespace = angular.isString(namespace) && namespace.length\n      ? namespace\n        .replace(/([A-Z])/g, '_$1')\n        .toUpperCase()\n      : null;\n\n    addStaticGetter(cls, 'annotation', () => Annotations.getActions(actionsName, cls));\n  };\n}\n\nexport function AsyncAction(actionName) {\n  return (cls, methodName) => {\n    addStaticGetterObjectMember(cls.constructor, 'serviceActions',\n      () => prepareActionName(cls, actionName, methodName), methodName);\n  };\n}\n\nexport function Action(actionName) {\n  return (cls, methodName, descriptor) => {\n    if (descriptor) {\n      const originalMethod = descriptor.value;\n      descriptor.value = function(...payload) {\n        const action = prepareActionName(cls, actionName, methodName);\n        const originalReturn = Reflect.apply(originalMethod, this, payload);\n        const dispatchPromise = this.dispatch(action, ...payload);\n        return angular.isDefined(originalReturn) ? originalReturn : dispatchPromise;\n      };\n    } else {\n      cls[methodName] = function(...payload) {\n        const action = prepareActionName(cls, actionName, methodName);\n        return this.dispatch(action, ...payload);\n      };\n    }\n  };\n}\n\nexport default ActionsAnnotation;\n\nfunction prepareActionName(cls, actionName, methodName) {\n  let preparedActionName = actionName;\n  if (!preparedActionName) {\n    preparedActionName = methodName.replace(/([A-Z])/g, '_$1');\n  }\n  const actionNamespace = cls.constructor.actionNamespace;\n  if (actionNamespace) {\n    preparedActionName = `${actionNamespace}_${preparedActionName}`;\n  }\n  return preparedActionName.toUpperCase();\n}\n"]}