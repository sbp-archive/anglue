{"version":3,"sources":["../../src/store.js"],"names":[],"mappings":"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","file":"store.js","sourcesContent":["import angular from 'angular';\n\nimport {Annotation} from './annotation';\nimport {Annotations} from './annotations';\nimport {EventEmitter as eventEmitterDecorator} from './behaviors/event-emitter';\n\nimport {addStaticGetterObjectMember, addStaticGetter} from './utils';\n\nexport class StoreAnnotation extends Annotation {\n  get serviceName() {\n    const name = this.name;\n    return `${name[0].toUpperCase()}${name.slice(1)}Store`;\n  }\n\n  getInjectionTokens() {\n    return [\n      'LuxyFlux',\n      'LuxyFluxStore',\n      'ApplicationDispatcher'\n    ].concat(super.getInjectionTokens());\n  }\n\n  get factoryFn() {\n    const TargetCls = this.targetCls;\n    const annotation = this;\n\n    return function(LuxyFlux, LuxyFluxStore, ApplicationDispatcher) {\n      const injected = Array.from(arguments).slice(3);\n      const instance = new TargetCls(...injected);\n\n      annotation.applyInjectionBindings(instance, injected);\n      annotation.applyDecorators(instance);\n\n      return LuxyFlux.createStore({\n        name: `store.${annotation.name}`,\n        dispatcher: ApplicationDispatcher,\n        handlers: TargetCls.handlers,\n        decorate: instance\n      }, LuxyFluxStore);\n    };\n  }\n\n  get module() {\n    if (!this._module) {\n      this._module = angular.module(\n        `stores.${this.name}`,\n        this.dependencies\n      );\n\n      this._module.factory(\n        this.serviceName,\n        this.getInjectionTokens().concat([this.factoryFn])\n      );\n\n      this.configure(this._module);\n    }\n    return this._module;\n  }\n}\n\nexport function Store(config) {\n  return cls => {\n    // Decorate a store with the EventEmitterBehavior\n    eventEmitterDecorator()(cls);\n\n    let storeName;\n    const isConfigObject = angular.isObject(config);\n\n    if (isConfigObject && config.name) {\n      storeName = config.name;\n    } else if (angular.isString(config)) {\n      storeName = config;\n    } else {\n      const clsName = cls.name.replace(/store$/i, '');\n      storeName = `${clsName[0].toLowerCase()}${clsName.slice(1)}`;\n    }\n\n    addStaticGetter(cls, 'annotation', () => Annotations.getStore(storeName, cls));\n  };\n}\n\nexport function Handlers(handlers) {\n  return cls => {\n    Object.keys(handlers).forEach(actionName => {\n      const handlerName = handlers[actionName];\n      addStaticGetterObjectMember(cls, 'handlers', actionName, handlerName);\n    });\n  };\n}\n\nexport function Handler(actionName, override = true) {\n  return (cls, handlerName) => {\n    let action = actionName;\n    if (!action) {\n      action = handlerName\n        .replace(/^on([A-Z])/, (match, first) => first.toLowerCase())\n        .replace(/([A-Z])/g, '_$1').toUpperCase();\n    }\n    addStaticGetterObjectMember(cls.constructor, 'handlers', action, handlerName, override);\n  };\n}\n\nexport default StoreAnnotation;\n"]}